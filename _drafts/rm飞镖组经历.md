---
layout: post
title: RM飞镖组经历
date: 2026-03-01 17:05 +0800
description: '飞镖视觉复盘：YOLO+轮廓拟合测偏差，上机参赛与赛场适应性踩坑'
categories: [复盘,项目复盘]
tags: [RoboMaster, 飞镖组, 视觉, 复盘]
---

## 背景与目标

飞镖组的核心需求很明确：**稳定识别引导灯（绿灯）**，计算目标相对画面中心线的偏差，并将“偏差 + 发射指令/触发条件”通过通信链路传给电控，用于自动瞄准与发射。

我负责飞镖视觉链路的方案落地、工程对接与上机参赛保障。

## 职责与交付范围

- 识别引导灯（绿灯）并输出目标中心点
- 将目标位置与中心线比较，输出横向偏差 $\Delta x$
- 依据规则生成发射指令（或触发条件）并通过串口/通信接口发送给电控
- 在 Intel NUC + Ubuntu 环境部署，与嵌入式对接并投入比赛
- 相机选型与调参（迈德威视相机 + 长焦镜头）

## 方案与实现

### 方案选择：YOLO 初识别 + ROI 内几何精定位

最终采用“检测 + 精定位”的组合方案，参考自瞄经验，优先保证工程可落地与调试效率：

1. **YOLO 初识别**：在整帧中定位引导灯的大致区域（ROI）
2. **ROI 内轮廓提取与拟合**：对 ROI 做轮廓提取，拟合圆形轮廓得到圆心（比仅用检测框中心更稳定）
3. **偏差计算**：

	$$\Delta x = x_{center} - \frac{W}{2}$$

	其中 $x_{center}$ 为拟合得到的圆心横坐标，$W$ 为图像宽度
4. **指令下发**：将 $\Delta x$ 与发射指令/状态打包发送给电控

我也尝试过一些替代方法（例如蒙日圆、神经网络直接回归中心坐标等），但在可解释性、实现复杂度、调试效率与稳定性上，最终方案更简单直接。

### 工程验证

- 在测试环境中自动发射联调无问题
- 赛前完成 NUC 部署与嵌入式对接，并实际投入比赛

## 比赛过程中的关键问题与定位

这条链路的“最终效果是理想的”，但并非一开始就顺利。主要踩坑集中在**赛场适应性**与**工程运行稳定性**两类。

### 1) 前几场比赛未识别到目标：从自动发射切到手动

- 现象：前几场比赛中无法稳定识别到目标，自动发射策略无法继续验证
- 临时决策：为保证能测落点与推进比赛进程，改为**手动控制发射**；但后续没有再切回自动

复盘看，这是典型的“比赛压力下的战术性取舍”：保证比赛推进没错，但我在流程上缺少一个“**切换回自动模式的明确触发条件与回归测试**”，导致临时方案变成了长期状态。

### 2) 适应性调试阶段大量时间花在调相机，但程序实际上可能已卡死

- 现象：调试时画面几乎卡死/无有效输出
- 当时行为：我把大量时间花在相机参数（曝光/增益等）上，认为是图像不够亮/不够清
- 事后反思：很可能在某些情况下程序已经卡死或性能不足（而我缺少“快速判断程序是否还活着”的观测手段），导致调参方向偏离根因

这暴露了我在工程化上的短板：对 ROS/C++ 满足于“能跑”，但对实时性、线程/队列、CPU 占用、日志与 watchdog 等缺少系统性保障。

### 3) 数据集采集方法不当，浪费了几场比赛窗口

- 我们曾在比赛中花了几场去“录数据集”，但采用视频内录的方式不可取：不手动停掉进程无法保存视频，导致采集效率和可用性都很差
- 后续用在观众席现场录制的数据集进行训练/调参后，才逐步实现稳定识别

这说明我在数据闭环上应该更早定义：**怎么采、怎么存、怎么回放、怎么标注、怎么迭代**，并确保采集工具本身可靠。

### 4) 环境过暗：训练数据环境单一导致泛化差

- 赛场环境很暗，引导灯亮度也显著低于测试环境
- 数据集环境相对单一，导致模型/阈值对亮度变化敏感
- 同时长焦镜头的调节更困难，而我缺少系统相机知识（只凭“测试时能调出来”的经验，低估了赛场难度）

## 最终结果

尽管前期经历了赛场适应性踩坑与数据闭环低效的问题，但在完成“现场数据→再训练/调参→再验证”的迭代后：

- 视觉链路能够**全程识别目标**并输出**精确偏差**
- 在 Intel NUC + Ubuntu 上稳定部署运行，并通过通信链路与嵌入式完成对接
- 比赛中取得了符合预期的效果（目标识别与偏差精度满足使用）

## 关键反思（面向下一次项目）

### 1) 先保证“看得见信号”，再谈泛化

这次最重要的提醒是：

- **必须确保相机画面中确实能看到灯**，再讨论模型泛化与算法策略
- 观众席、准备阶段都可以用电脑快速验证，此时优先做的事情应该是“调相机让目标可见”

### 2) 现场适应性要用流程兜底，而不是靠临场感觉

如果重来，我会在赛前准备一个更硬的 checklist：

- 亮度/曝光/增益的可复制参数方案（不同光照档位）
- 一键录制与回放工具（保证数据能落盘）
- 关键指标可观测（FPS、CPU 占用、推理耗时、队列长度、串口发包频率）

### 3) 代码“能用”不等于“赛场稳定”

我对 ROS 与 C++ 只停留在能用层面，没有主动做性能与稳定性提升，这很可能是适应性阶段“画面几乎卡死”的根因之一。

下一步提升方向会是：

- 推理与图像处理链路的耗时 profiling
- 异常场景（无目标、过暗、过曝、通信断开）下的降级策略
- 长时间运行的内存/资源泄漏排查
