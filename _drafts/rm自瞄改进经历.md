---
layout: post
title: RM自瞄改进经历
date: 2026-03-01 17:13 +0800
description: '自瞄迭代复盘：数字分类器升级、角点抖动校正、与步兵联调命中率提升'
category: '项目复盘'
tags: [RoboMaster, 自瞄, 视觉, OpenVINO, 复盘]
---

## 背景与目标

RoboMaster 自瞄的目标是：识别敌方装甲板（灯条 + 数字），解算装甲板位姿，进一步拟合得到车辆的运动状态（位置/速度/加速度），预测未来位置并下发发射指令，使弹丸命中装甲板。

我在这段经历中主要承担“已有自瞄框架上的改进与联调”，核心产出集中在三个任务：

1. 改进数字分类器（提升数字识别可靠性并落地部署）
2. 角点校正（降低角点抖动对 PnP 解算的影响）
3. 与步兵组对接联调（把“识别/解算/预测”在车上调到能打）

## 任务1：改进数字分类器（模型效果与部署）

### 问题

原有数字分类器结构较简单，效果不稳定，容易在复杂光照/运动模糊/数字边缘不清的情况下误判，进而影响整条自瞄链路的目标选择与姿态估计。

### 行动

- 使用 **ResNet 残差网络**重新训练数字分类器
- 对数据集做了**扩充与清洗**（尽可能减少脏标注/低质量样本对训练的负面影响）
- 增加 **OpenVINO 推理**以适配上机部署
- 迭代模型规模：
	- 初始网络偏大，后续做结构删减与压缩
	- 将模型体积压到约 **500KB** 量级
	- 结合一些 AI 给出的工程优化建议做进一步调参（例如训练策略/增强/正则化方向的建议）

### 结果

- 功能上基本达成目标：数字分类相较原方案明显更可用，并可在 OpenVINO 路径部署
- 仍出现一定过拟合迹象：在某些场景泛化不如预期

### 反思与改进方向

- 过拟合可能来自两类根因：**网络设计/容量**与**数据分布**（环境单一、难例不足）
- 如果继续迭代，我会优先做：
	- 更系统的数据分层与难例挖掘（暗光、运动模糊、远距离小目标、反光）
	- 更明确的验证集划分与指标记录（避免“凭感觉变好”）
	- 在模型结构稳定后再做量化/蒸馏等压缩，减少“边改结构边压缩”导致的不可控因素

## 任务2：自瞄角点校正（解决抖动与解算不稳）

### 问题

角点神经网络受限于训练数据量与角点标注质量，推理出的角点存在明显抖动；抖动会直接放大到 PnP 姿态解算，导致云台/发射决策不稳定。

### 行动

一开始我尝试过纯滤波方案，但感觉偏“掩盖问题”。后续改为“**用网络角点作先验 + 传统视觉做几何校正**”的融合思路：

1. 将网络输出角点作为前置信息（虽然抖，但基本落在灯条角点附近）
2. 在 ROI 内做二值化，提取轮廓
3. 通过角点连线快速定位灯条轮廓（减少误轮廓干扰）
4. 对轮廓做椭圆拟合，得到长轴方向
5. 用长轴方向画线，并结合长轴与轮廓角点，得到**校正后角点**

为解决倾斜角度较大时灯条轮廓不完整的问题，我在校正上叠加了“二次校正”策略：

- 将一次校正按左右灯条分别执行
- 初始使用较高阈值的二值化结果校正：倾斜角度较小时通常成功
- 对失败的一侧降低阈值再次校正，尽可能补全轮廓信息
- 最后做**合理性检验**，防止不合理角点进入 PnP 解算器（宁可拒绝/降级，也不要输出污染后端）

### 结果

- 角点抖动对后端的影响显著下降，PnP 解算更稳定
- 在大倾斜角度场景下可用性提升（通过二次校正 + 合理性检验降低失败率）

### 反思与改进方向

- 这是一个典型的“深度先验 + 几何约束”的工程折中：既利用网络的召回能力，也用几何提升稳定性
- 后续若继续优化，我会补齐：
	- 角点置信度与拒绝策略的更严格定义（什么时候直接走降级路径）
	- ROI 与阈值自适应策略的可观测指标（避免比赛现场靠手感调）

## 任务3：与步兵组对接联调（把链路调到能打）

### 目标

把“识别→位姿→运动拟合→预测→补偿→发射”这条链路在真实车辆上打通，并将命中率提升到可用水平。

### 行动

- 先花时间读代码，理解整体架构与运行流程，明确各模块接口与关键参数含义
- 按需求修改/校对：相机内参、车体实体参数、通信对接
- 联调路径按“先稳再快”的顺序推进：
	- 看通信是否正常
	- 看识别是否稳定
	- 调偏差与坐标/补偿（在小误差且迫不得已时加补偿）
	- 先静止调好，再移动调好

### 结果

- 调车后命中率达到约 **60%**（以当时调试统计为准）

### 反思

- 联调的关键不在某个单点算法，而是把“参数、坐标系、接口、延迟、补偿”的假设逐个验证
- 如果时间允许，应该建立更标准的联调记录（每次改动对应的指标变化），减少重复试错

## 总结：这段经历让我真正理解“工程可用”的含义

- 在自瞄这种强系统耦合任务里，单点精度只是基础，**稳定性、可观测性与可调性**才决定比赛表现
- 两条最有效的改进路径：
	- 把关键输出做稳定（角点校正保证 PnP 不抖）
	- 把模型落地到可部署（OpenVINO 推理 + 体积压缩）
